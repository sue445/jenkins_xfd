<html>
<head>
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;"/>
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Jenkins XFD</title>
    <link rel="stylesheet" href="./xfd.css" type="text/css"/>
</head>
<body>

<span id="last_update"></span>
<div id="main_contents">

</div>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript">
    (function($){
        function currentTime(){
            var d = new Date();
            var month = d.getMonth() + 1;

            return d.getFullYear() + "/" + pad(month) + "/" + pad(d.getDate()) + " " + pad(d.getHours()) + ":" + pad(d.getMinutes()) + ":" + pad(d.getSeconds());
        }

        function pad(num){
            return num < 10 ? "0" + num : num;
        }

        $(document).ready(function(){
            var job_urls = [
                "https://sue445.ci.cloudbees.com/job/azusaar/",
                "https://sue445.ci.cloudbees.com/job/kulib/",
            ];
            var reload_seconds = 30;

            for(var i = 0; i < job_urls.length; i++){
                var api_url = job_urls[i] + "/api/json";
                $.ajax({
                    url: api_url,
                    dataType: "jsonp",
                    jsonp: "jsonp"
                }).then(function(res){
                        var test_result = "unknown";
                        if(res.color == "blue") test_result = "success";
                        else if(res.color == "red") test_result = "error";

                        var label = $("<h1/>").addClass("project_label").text(res.displayName);

                        var project = $("<div/>").addClass("project").addClass(test_result);
                        project.append(label);

                        $("#main_contents").append(project);
                });
            }

            setTimeout(function(){
                location.reload(false);
            }, reload_seconds * 1000);

            $("#last_update").text(currentTime());
        });
    })(jQuery);
</script>

</body>
</html>
